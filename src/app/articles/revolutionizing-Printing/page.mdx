import { ArticleLayout } from '@/components/ArticleLayout'
import Revolutionizing3DPrinting from './image3.webp'


export const article = {
  author: 'Hirusha Maduwantha',
  date: '2024-12-24',
  title: `Revolutionizing 3D Printing: Overcoming G-code Limitations with Dynamic Control`,
  description: `3D printing has become a cornerstone of modern manufacturing and prototyping, but it still has its quirks and limitations. One of the most significant issues I’ve encountered is the inability to modify G-code once a print job has started. This limitation often leaves users unable to make necessary adjustments mid-print, such as altering settings, inserting hardware, or addressing errors.`,
}

export const metadata = {
  title: article.title,
  description: article.description,
}

export default (props) => <ArticleLayout article={article} {...props} />



## Exploring Real-Time G-code Adjustments to Enhance 3D Printing Flexibility and Address Common Limitations in Existing Systems.
---

## Introduction

<figure className="mx-auto max-w-3xl">
  <Image
    src={Revolutionizing3DPrinting}
    alt="Revolutionizing3DPrinting"
    className="mx-auto rounded-md"
  />
  <figcaption className="mt-2 text-sm text-zinc-500 dark:text-zinc-400 text-center">
   Photo by Jakub Żerdzicki on Unsplash
  </figcaption>
</figure>

3D printing has become a cornerstone of modern manufacturing and prototyping, but it still carries significant constraints.  
One of the biggest limitations is the **inability to modify G-code once a print job has started**.  

This creates issues such as:

- inability to add or change settings mid-print  
- difficulty inserting hardware inside prints  
- no easy way to correct errors without restarting  

To address this, I began experimenting with **real-time G-code control**, exploring ways to bypass static G-code files and interact directly with the printer during operation.

---

## Understanding the Current Landscape

Before building my own solution, I studied existing tools and resources.

### **Prusa Knowledge Base**
PrusaSlicer allows inserting pauses or custom G-code at specific layers.  
Useful for:
- filament color swaps  
- embedding nuts, magnets, bearings  

### **Community Forums**
Prusa3D forums contain scripts, tips, and user hacks for mid-print changes.

### **Reddit Discussions**
Users often share practical mid-print modification methods:
- real-time filament swaps  
- pausing to embed hardware  

These insights helped shape a better understanding of the problem.

---

## Key Considerations for Dynamic G-code Adjustment

When attempting real-time G-code modification, you must consider:

### ✔ Firmware Compatibility
Not all printers allow:
- pausing  
- resuming  
- buffer flushing  
- arbitrary G-code injection  

### ✔ Software Tools
Tools like PrusaSlicer, OrcaSlicer, or Cura allow scripted pauses.

### ✔ Manual G-code Editing
Advanced users can edit G-code manually, but this requires:
- syntax knowledge  
- understanding motion planning  
- knowing buffer behavior  

All of this led me to explore something new…

---

## My Approach: Real-time G-code Transmission with Python

To bypass limitations of existing slicers, I experimented with **sending G-code dynamically using Python + pyserial**.

---

## Step 1 — Sending Simple G-code Commands

```python
import serial
import time

# Configuration
SERIAL_PORT = 'COM4'  # Replace with your printer's serial port
BAUD_RATE = 38400    # Adjust to your printer's baud rate

def send_gcode_command(command, printer):
    """Send a G-code command to the 3D printer."""
    printer.write(f"{command}\n".encode('utf-8'))
    printer.flush()
    while True:
        response = printer.readline().decode('utf-8').strip()
        print(f"Response: {response}")
        if response == "ok":
            break

def main():
    try:
        with serial.Serial(SERIAL_PORT, BAUD_RATE, timeout=5) as printer:
            time.sleep(2)
            print("Connected to the printer.")
            
            send_gcode_command("G28", printer)  # Home all axes
            send_gcode_command("G1 X10 Y10 Z10 F3000", printer)  # Move
                
            print("Commands sent successfully.")
    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    main()
```

### Lesson Learned

Using the wrong baud rate causes:

- freezing  
- ignored commands  
- random disconnections  

**Correct baud rate = smoother communication.**

---

## Step 2 — Sending G-code Line-by-Line

```python
import serial
import time
import os

SERIAL_PORT = 'COM4'
BAUD_RATE = 38400
GCODE_FILE = 'path/to/file.gcode'

def send_gcode_line(line, printer):
    printer.write(f"{line}\n".encode('utf-8'))
    printer.flush()
    response = printer.readline().decode('utf-8').strip()
    print(f"Response: {response}")

def monitor_and_print():
    last_position = 0

    try:
        with serial.Serial(SERIAL_PORT, BAUD_RATE, timeout=5) as printer:
            time.sleep(2)
            print("Connected to the printer.")

            while True:
                with open(GCODE_FILE, 'r') as gcode_file:
                    gcode_file.seek(last_position)
                    new_lines = gcode_file.readlines()

                    for line in new_lines:
                        line = line.strip()
                        if line and not line.startswith(';'):
                            print(f"Sending: {line}")
                            send_gcode_line(line, printer)

                    last_position = gcode_file.tell()

                time.sleep(1)
    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    monitor_and_print()
```


### Result
Works, but jerky motion due to waiting for ok after every line.


## Step 3 — Sending G-code in Batches (Much Faster)

```
import os
import time
import serial

GCODE_FILE = r'C:\path\to\your\gcode_file.gcode'
SERIAL_PORT = 'COM4'
BAUD_RATE = 38400

def send_gcode_batch(gcode_lines, printer):
    for line in gcode_lines:
        line = line.strip()
        if line and not line.startswith(';'):
            printer.write(f"{line}\n".encode('utf-8'))
    printer.flush()

def monitor_and_print_fast():
    try:
        with serial.Serial(SERIAL_PORT, BAUD_RATE, timeout=5) as printer:
            time.sleep(2)
            print("Connected to the printer.")

            last_modified_time = 0

            while True:
                current_modified_time = os.path.getmtime(GCODE_FILE)
                if current_modified_time > last_modified_time:
                    last_modified_time = current_modified_time
                    print(f"File modified. Reloading...")

                    with open(GCODE_FILE, 'r') as gcode_file:
                        gcode_lines = gcode_file.readlines()
                        print(f"Sending {len(gcode_lines)} lines...")
                        send_gcode_batch(gcode_lines, printer)

                    print("All commands sent.")
                else:
                    time.sleep(1)
    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    monitor_and_print_fast()
```



## Outcome

- Movements became **smooth**  
- Execution became **faster**  
- But sometimes… the **printer freezes**

### Likely Causes

- buffer overflow  
- missing `ok` acknowledgment  
- flow control issues  

---

## Challenges & Future Work

### Buffer Overflows
Sending too much too fast overwhelms the printer’s internal queue.

###Real-Time Reactivity
A proper UI is needed to pause, modify, and resume print jobs dynamically.

### Firmware Differences
Marlin, Klipper, and Repetier each handle command buffers in different ways.

---

## Conclusion

This exploration demonstrates that **dynamic G-code control is absolutely possible**, but it requires careful management of:

- serial communication timing  
- printer firmware behavior  
- command buffering and flow control  

I’m excited to continue refining this system to create a more flexible, adaptive, and interactive 3D printing workflow.

**Have you tried modifying G-code mid-print?  
Let’s discuss it — I’d love to hear your experiences!**
